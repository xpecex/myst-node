dist: xenial
language: minimal
env:
  global:
    - ALT_NAME="xpecex/myst-node"
    - ALT_REF="$(cat /dev/urandom | tr -dc 'a-z0-9' | fold -w 7 | head -n 1)"
    - DOCKER_CLI_EXPERIMENTAL="enabled"
before_install:
  - sudo apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get install -y docker-ce docker-ce-cli containerd.io
  - docker run --privileged --rm tonistiigi/binfmt --install all
install:
  - docker buildx create --use --name builder --driver docker-container --driver-opt image=moby/buildkit:master --buildkitd-flags '--oci-worker-snapshotter=stargz'
  - docker buildx inspect --bootstrap
script: bash build.sh